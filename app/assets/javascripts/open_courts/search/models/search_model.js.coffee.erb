class OpenCourts.SearchModel extends Backbone.AbstractModel
  @include Util.Logger
  @include Util.Model.Attributes

  defaults:
    category:   ['PojednÃ¡vania']
    judges: []
    courts: []
    
  initialize: ->
    @.log 'Initializing ...'

    @page = 1

    @.log 'Initialized.'

  getCategory: ->
    @.getValue('category')

  setCategory: (value) ->
    @.setValue('category', value)
    
  find: (term, callback) ->
    $.ajax
      url: 'blabla'
      type: 'POST'
      data:
        data:
          type: @.getType()
          title: term
      success: (response) ->
        callback?(response)
      error: ->
        @.err "Error occured while finding: #{term}"

  search: (callback) ->
    $.ajax
      url: "/search"
      type: "POST"
      data:
        page: @page,
        data: @.toJSON()
      success: (response) =>
        @facets = response.facets

        @.log "Response: #{@.inspect response}"
                
        callback?(response)
      error: ->
        @.err "Error occured while searching (model=#{@.toJSON()})"

  values: (field) ->
    @facets?[field]?.map (facet) -> facet.term

  facet: (field, value) ->
    @facets?.facets?[field]?[value] or ""
